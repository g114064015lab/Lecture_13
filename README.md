# 臺灣36小時天氣預報儀表板（Streamlit）

以中央氣象署開放資料集 [F-A0021-001](https://opendata.cwa.gov.tw/dataset/forecast/F-A0021-001) 為基礎的即時互動式儀表板。介面以 Streamlit 建置，可快速檢視全臺各縣市未來 36 小時的溫度、體感溫度、降雨機率與天氣描述。

## 功能亮點
- 串接中央氣象署 REST API，解析各縣市的三時段（12 小時）預報資訊。
- 以互動式側欄列出所有縣市，點選後顯示詳細天氣指標與時序圖。
- 顯示資料更新時間並提供手動重新整理按鈕；背景自動快取 15 分鐘以減少 API 呼叫。
- 內建錯誤提示與空資料處理，確保非預期狀況下仍能提供使用回饋。
- 可自訂 API 金鑰與預設顯示縣市。

## 環境需求
- Python 3.9+
- pip

## 安裝與執行
1. 取得中央氣象署開放資料平臺 API 金鑰。
2. 於專案根目錄建立 `.env` 檔或於系統環境變數設定（若未設定則會使用預設金鑰 `CWA-FE3705DB-3102-48DE-B396-30F5D45306C2`）：
   ```
   CWA_API_KEY=你的金鑰
   ```
3. 安裝依賴：
   ```bash
   pip install -r requirements.txt
   ```
4. 啟動服務：
   ```bash
   streamlit run app.py
   ```

## 專案結構
```
├─app.py               # Streamlit 主程式，整合資料抓取、資料視覺化與互動控制
├─requirements.txt     # Python 依賴
├─README.md            # 使用與部署說明
└─docs
   └─ARCHITECTURE.md   # 深入技術文件：模組、資料流與部署筆記
```

## 指令介面說明
- **縣市列表**：側欄列出所有縣市，包含當前時段的溫度與天氣描述。支援搜尋與排序。
- **主要區塊**：顯示選定縣市的最新溫度、體感溫度、降雨機率以及文字化天氣概述。
- **時序視覺化**：使用折線圖呈現 36 小時內的溫度與體感溫度變化；下方表格列出各時段的降雨機率與天氣描述。
- **資料更新**：畫面上方顯示資料取得時間；按下重新整理按鈕可立即呼叫 API。

## 資料流程與快取策略
1. 以 `CWA_API_KEY` 向 F-A0021-001 REST API 發送 JSON 請求。
2. 將回傳資料標準化為 `locations -> timeline` 結構，以方便繪製卡片與圖表。
3. 透過 `st.cache_data` 快取 15 分鐘，畫面載入時會先顯示快取資料，若使用者點選「重新整理」則強制更新。
4. 若 API 回傳錯誤或網路請求失敗，UI 會顯示錯誤提示並阻止後續渲染，避免留下不完整介面。

## UI/UX 重點
- H1 標題搭配資料發布時間與「重新整理資料」按鈕。
- 內建淺色／深色模式切換，偏好存於 `st.session_state`。
- 線上卡片顯示 36 小時（每 12 小時一段）的天氣摘要；Altair 折線圖比較平均溫度與體感溫度趨勢。
- 表格提供完整欄位：起迄時間、天氣描述、溫度範圍、體感溫度、降雨機率、舒適度指標。

## 設定
| 環境變數 | 預設 | 說明 |
| --- | --- | --- |
| `CWA_API_KEY` | CWA-FE3705DB-3102-48DE-B396-30F5D45306C2 | 預設使用此金鑰，可自行於 `.env` 覆寫 |
| `CWA_DEFAULT_LOCATION` | 臺北市 | 選擇頁面載入時預設顯示的縣市 |

## 開發提示
- `app.py` 為主要入口，整合資料抓取、快取與 UI 邏輯，可依需求拆分模組。
- 若需部署到雲端（如 Streamlit Community Cloud），請將 `CWA_API_KEY` 及其他機密值放於 `secrets.toml` 或專案設定中的 Secrets。
- 進一步的資料欄位對應、快取策略與部署建議可參考 `docs/ARCHITECTURE.md`。

## 授權
此專案以 MIT License 發佈。使用時請遵守中央氣象署開放資料使用規範。
